CREATE OR REPLACE VIEW mktg_ops_vws.bz_digital_analytics_txn AS 
SELECT ("collate"((COALESCE((adobe.prch_id)::character varying(40), ''::character varying))::text, 1))::character varying AS prch_id, ("collate"((COALESCE((adobe.source1)::character varying(40), ''::character varying))::text, 1))::character varying AS source1, ("collate"((COALESCE((adobe.medium1)::character varying(40), ''::character varying))::text, 1))::character varying AS medium1, ("collate"((COALESCE((adobe.cid_dsc)::character varying(40), ''::character varying))::text, 1))::character varying AS cid_dsc, ("collate"((COALESCE((adobe.device)::character varying(40), ''::character varying))::text, 1))::character varying AS device, ("collate"((COALESCE((adobe.lst_touch_chnl)::character varying(40), ''::character varying))::text, 1))::character varying AS lst_touch_chnl, ("collate"((COALESCE((adobe.trans_cd)::character varying(40), ''::character varying))::text, 1))::character varying AS trans_cd, ("collate"((COALESCE((adobe.trans_dsc)::character varying(40), ''::character varying))::text, 1))::character varying AS trans_dsc, ("collate"((COALESCE(adobe.src_cd, ''::character varying))::text, 1))::character varying AS src_cd, ("collate"((COALESCE(adobe.subsrc_cd, ''::character varying))::text, 1))::character varying AS subsrc_cd, COALESCE((adobe.lightbx_imprsn_cnt)::integer, 0) AS lightbx_imprsn_cnt, COALESCE((adobe.lightbx_accpt_cnt)::integer, 0) AS lightbx_accpt_cnt, COALESCE((adobe.lightbx_decln_cnt)::integer, 0) AS lightbx_decln_cnt FROM (SELECT adobe_analytics_txn.prch_id, adobe_analytics_txn.source1, adobe_analytics_txn.medium1, adobe_analytics_txn.cid_dsc, adobe_analytics_txn.device, adobe_analytics_txn.lst_touch_chnl, 'AA'::character varying AS trans_cd, 'Adobe Analytics'::character varying AS trans_dsc, adobe_analytics_txn.src_cd, adobe_analytics_txn.subsrc_cd, adobe_analytics_txn.lightbx_imprsn_cnt, adobe_analytics_txn.lightbx_accpt_cnt, adobe_analytics_txn.lightbx_decln_cnt, pg_catalog.row_number() OVER(  PARTITION BY adobe_analytics_txn.prch_id ORDER BY adobe_analytics_txn.lst_touch_chnl) AS rn FROM mktg_ops_tbls.adobe_analytics_txn) adobe WHERE (adobe.rn = 1) UNION ALL SELECT ("collate"((COALESCE((google.prch_id)::character varying(40), ''::character varying))::text, 1))::character varying AS prch_id, ("collate"((COALESCE((google.source1)::character varying(40), ''::character varying))::text, 1))::character varying AS source1, ("collate"((COALESCE((google.medium1)::character varying(40), ''::character varying))::text, 1))::character varying AS medium1, ("collate"((COALESCE((google.cid_dsc)::character varying(40), ''::character varying))::text, 1))::character varying AS cid_dsc, ("collate"((COALESCE((google.device)::character varying(40), ''::character varying))::text, 1))::character varying AS device, ("collate"((COALESCE((google.lst_touch_chnl)::character varying(40), ''::character varying))::text, 1))::character varying AS lst_touch_chnl, ("collate"((COALESCE((google.trans_cd)::character varying(40), ''::character varying))::text, 1))::character varying AS trans_cd, ("collate"((COALESCE((google.trans_dsc)::character varying(40), ''::character varying))::text, 1))::character varying AS trans_dsc, ("collate"((COALESCE((google.src_cd)::character varying(20), ''::character varying))::text, 1))::character varying AS src_cd, ("collate"((COALESCE((google.subsrc_cd)::character varying(40), ''::character varying))::text, 1))::character varying AS subsrc_cd, COALESCE(((google.lightbx_imprsn_cnt)::smallint)::integer, 0) AS lightbx_imprsn_cnt, COALESCE(((google.lightbx_accpt_cnt)::smallint)::integer, 0) AS lightbx_accpt_cnt, COALESCE(((google.lightbx_decln_cnt)::smallint)::integer, 0) AS lightbx_decln_cnt FROM (SELECT bz_google_analytics_txn.trans_id AS prch_id, bz_google_analytics_txn.source1, bz_google_analytics_txn.medium1, bz_google_analytics_txn.campaign AS cid_dsc, bz_google_analytics_txn.device, bz_google_analytics_txn.channel_grp AS lst_touch_chnl, 'GA'::character varying AS trans_cd, 'Google Analytics'::character varying AS trans_dsc, NULL::character varying AS src_cd, NULL::character varying AS subsrc_cd, NULL::character varying AS lightbx_imprsn_cnt, NULL::character varying AS lightbx_accpt_cnt, NULL::character varying AS lightbx_decln_cnt, pg_catalog.row_number() OVER(  PARTITION BY bz_google_analytics_txn.trans_id ORDER BY bz_google_analytics_txn.channel_grp) AS rn FROM mktg_ops_tbls.bz_google_analytics_txn) google WHERE (google.rn = 1) WITH NO SCHEMA BINDING;